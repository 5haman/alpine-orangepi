#!/bin/execlineb -P

foreground {
    /bin/busybox --install -s
}

/bin/export PATH "/usr/local/bin:/usr/local/sbin:/usr/bin:/usr/sbin:/bin:/sbin"
/bin/cd /
s6-setsid -qb --
umask 022

foreground {
    if { mkdir -p /dev/shm /dev/mqueue /dev/pts /var/lib/docker }
    if { chown 99:99 /var/log }
    if { cp -r /etc/s6-init/run-image/service /run/ }
    if { mkfifo -m 0600 /run/service/s6-svscan-log/fifo }
}
emptyenv -p
s6-envdir -I -- /etc/s6-init/env
redirfd -r 0 /dev/null
redirfd -wnb 1 /run/service/s6-svscan-log/fifo
background
{
  s6-setsid --
  redirfd -w 1 /run/service/s6-svscan-log/fifo
  fdmove -c 2 1
  /etc/rc.init
}
unexport !
cd /run/service
fdmove -c 2 1
s6-svscan -st0
