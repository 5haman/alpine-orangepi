#!/bin/execlineb -P

foreground {
    /bin/busybox --install -s
}

/bin/export PATH "/usr/bin:/usr/sbin:/bin:/sbin"
/bin/cd /
s6-setsid -qb --
umask 022

foreground {
    if { s6-echo -- "=> Mounting filesystems..." }
    if { s6-mount -a }
    if { s6-chown -u 99 -g 99 /var/log }
    if { s6-hiercopy /etc/s6-init/run-image /run }
    if { s6-mkfifo -m 0600 /run/service/s6-svscan-log/fifo }
    if { s6-echo -- "=> Loading environment..." }
}
emptyenv -p
s6-envdir -I -- /etc/s6-init/env
redirfd -r 0 /dev/null
redirfd -wnb 1 /run/service/s6-svscan-log/fifo
background
{
  s6-setsid --
  redirfd -w 1 /run/service/s6-svscan-log/fifo
  fdmove -c 2 1
  /etc/rc.init
}
unexport !
cd /run/service
fdmove -c 2 1
s6-svscan -st0
